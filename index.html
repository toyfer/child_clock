<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>子供向けアナログ時計</title>
  <!-- SEO & OGP for GitHub Pages -->
  <meta name="description" content="子供向けの楽しいアナログ時計学習アプリ。GitHub Pagesで公開。" />
  <meta property="og:title" content="こどもアナログとけい" />
  <meta property="og:description" content="子供向けの楽しいアナログ時計学習アプリ。" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="assets/ogp.png" />
  <meta property="og:url" content="https://<YOUR_GITHUB_USERNAME>.github.io/child_clock/" />
  <link rel="canonical" href="https://<YOUR_GITHUB_USERNAME>.github.io/child_clock/" />
  <!-- Favicon for GitHub Pages -->
  <link rel="icon" href="assets/favicon.ico" />
  <!-- PWA manifest (optional) -->
  <link rel="manifest" href="assets/manifest.json" />
  <meta name="theme-color" content="#ffb300" />
  <link rel="apple-touch-icon" href="assets/favicon.ico" />
  <link rel="stylesheet" href="assets/style.css" />
  <script>
    // PWA: Service Worker登録
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./service-worker.js').catch(function(e){
          console.warn('SW registration failed:', e);
        });
      });
    }
  </script>
</head>
<body>
  <div class="title">こどもアナログとけい</div>
  <div class="desc" id="desc" aria-live="polite">じかんを たのしく おぼえよう！</div>
  <button id="theme-btn" aria-label="テーマ切替" title="テーマ切替" style="margin-left:1em;">テーマ切替</button>
  <div id="clock" role="img" aria-label="アナログ時計"></div>
  <script src="simple-clock.js"></script>
  <script>
    /**
     * 星の装飾をランダムにbodyへ追加する
     * @param {number} starCount - 追加する星の数
     * @throws {Error} body要素が存在しない場合
     * 前提条件: body要素が存在すること
     * 事後条件: bodyに.starクラスのdivがstarCount個追加される
     */
    function addRandomStars(starCount) {
      const body = document.body;
      if (!body) {
        console.error('addRandomStars: <body>要素が見つかりません');
        throw new Error('addRandomStars: <body>要素が見つかりません');
      }
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.textContent = '★';
        star.style.left = (10 + Math.random() * 80) + 'vw';
        star.style.top = (5 + Math.random() * 85) + 'vh';
        star.style.transform = `rotate(${Math.random()*360}deg)`;
        if (!body) throw new Error('addRandomStars: <body>がnull');
        body.appendChild(star);
      }
    }
    addRandomStars(8);

    /**
     * テーマ適用処理（CSS変数方式）
     * @param {boolean} isDark - ダークテーマかどうか
     * 事後条件: bodyのクラスが切り替わり、CSS変数で色が反映される
     */
    function applyTheme(isDark) {
      const descElem = document.getElementById('desc');
      const themeBtn = document.getElementById('theme-btn');
      document.body.classList.toggle('theme-dark', isDark);
      // テーマ名でaria-labelやボタン文言も切替
      if (themeBtn) themeBtn.textContent = isDark ? 'ライトテーマ' : 'ダークテーマ';
      if (themeBtn) themeBtn.setAttribute('aria-label', isDark ? 'ライトテーマに切替' : 'ダークテーマに切替');
      if (descElem) descElem.setAttribute('aria-live', 'polite');
    }

    /**
     * テーマ切替ボタンの初期化・イベント登録
     * テーマ状態をlocalStorageで永続化
     * @throws {Error} #theme-btn, #descが見つからない場合
     * 前提条件: #themeBtn, #descElemが存在
     * 事後条件: ボタン押下でテーマが切り替わり、状態が永続化される
     */
    function setupThemeToggle() {
      const themeBtn = document.getElementById('theme-btn');
      const descElem = document.getElementById('desc');
      if (!themeBtn) {
        console.error('setupThemeToggle: #theme-btnが見つかりません');
        throw new Error('setupThemeToggle: #theme-btnが見つかりません');
      }
      if (!descElem) {
        console.error('setupThemeToggle: #descが見つかりません');
        throw new Error('setupThemeToggle: #descが見つかりません');
      }
      // localStorageからテーマ状態を取得
      let isDark = localStorage.getItem('theme') === 'dark';
      applyTheme(isDark);
      themeBtn.onclick = function() {
        isDark = !isDark;
        applyTheme(isDark);
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      };
    }
    setupThemeToggle();
  </script>
</body>
</html>
